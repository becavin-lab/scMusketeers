2025-12-16 22:10:38.186691: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-12-16 22:10:38.292764: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
|--- DEBUG       Program arguments: Namespace(process='transfer', ref_path='/workspace/cell/scMusketeers/data/Deprez-Lung-unknown-0.2.h5ad', debug=True, class_key='celltype', batch_key='donor', query_path=None, out_dir='/workspace/cell/scMusketeers', out_name='Deprez-Lung-unknown-0.2-pred', training_scheme='training_scheme_1', log_neptune=True, neptune_name='sc-musketeers', opt_metric='val-balanced_mcc', verbose=True, bestparam_path='/workspace/cell/scMusketeers/experiment_script/hyperparam/hp_best_ajrccm.csv', hparam_path=None, working_dir=None, total_trial=100, dataset_name=None, task=None, gpu_models='True', unlabeled_category='Unknown', filter_min_counts=True, normalize_size_factors=True, size_factor='default', scale_input=False, logtrans_input=True, use_hvg=None, batch_size=430, test_split_key='TRAIN_TEST_split', test_obs=None, test_index_name=None, mode='percentage', pct_split=0.9, obs_key='manip', n_keep=None, split_strategy=None, keep_obs=None, train_test_random_seed=0, obs_subsample=None, make_fake=False, true_celltype=None, false_celltype=None, pct_false=None, weight_decay=4.631975708726384e-06, learning_rate=8.414230867858422e-05, optimizer_type='adamw', warmup_epoch=20, fullmodel_epoch=50, permonly_epoch=50, classifier_epoch=50, balance_classes=True, clas_loss_name='categorical_focal_crossentropy', dann_loss_name='categorical_crossentropy', rec_loss_name='MSE', clas_w=0.33157074856597474, dann_w=3.3941467292805104e-05, rec_w=0.022339522184988584, dropout=0.22089440817089676, layer1=1084, layer2=404, bottleneck=126, ae_hidden_size=[128, 64, 128], ae_hidden_dropout=None, ae_activation='relu', ae_bottleneck_activation='linear', ae_output_activation='relu', ae_init='glorot_uniform', ae_batchnorm=True, ae_l1_enc_coef=None, ae_l2_enc_coef=None, class_hidden_size=[64], class_hidden_dropout=None, class_batchnorm=True, class_activation='relu', class_output_activation='softmax', dann_hidden_size=[64], dann_hidden_dropout=None, dann_batchnorm=True, dann_activation='relu', dann_output_activation='softmax')
|--- INFO        Setting hyperparameters provided for the model in: /workspace/cell/scMusketeers/experiment_script/hyperparam/hp_best_ajrccm.csv
|--- INFO        Run transfer
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1765919452.914593 1166945 gpu_device.cc:2020] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 30824 MB memory:  -> device: 0, name: Tesla V100-SXM2-32GB, pci bus id: 0000:18:00.0, compute capability: 7.0
|--- INFO        Use Neptune.ai log : True
|--- INFO        Use Neptune project name = sc-musketeers
Best param path: /workspace/cell/scMusketeers/experiment_script/hyperparam/hp_best_ajrccm.csv
False
False
False
{'use_hvg': '5431', 'batch_size': '156', 'clas_w': '0.33157074856597474', 'dann_w': '3.3941467292805104E-5', 'rec_w': '0.022339522184988584', 'ae_bottleneck_activation': 'linear', 'clas_loss_name': 'categorical_focal_crossentropy', 'size_factor': 'default', 'weight_decay': '4.631975708726384E-6', 'learning_rate': '8.414230867858422E-5', 'warmup_epoch': '20', 'dropout': '0.22089440817089676', 'layer1': '1084', 'layer2': '404', 'bottleneck': '126', 'training_scheme': 'training_scheme_1'}
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-musketeers/e/SCMUS-242
|--- INFO        Load /workspace/cell/scMusketeers/data/Deprez-Lung-unknown-0.2.h5ad
|--- DEBUG      /workspace/cell/scMusketeers/scmusketeers/transfer/dataset_tf.py:149|--- DEBUG       Calculate HVG
|--- DEBUG       Selecting 5431 HVG
|--- DEBUG       Normalize with total nb reads and calculate size factor
|--- DEBUG       Log_1 transformation
|--- DEBUG       Calculate size factor (default mode)
/workspace/cell/scMusketeers/scmusketeers/transfer/dataset_tf.py:354: ImplicitModificationWarning:

Trying to modify attribute `.obs` of view, initializing view as actual.

|--- INFO        ##-- Create scmusketeers model and the train/test/val datasets:
|--- DEBUG       hyperparameters.make_experiment()
|--- DEBUG       Setup X,Y
|--- DEBUG       Create pseudo-labels pseudo_y_list
|--- INFO        Setup model settings
|--- INFO        Setup optimizer
|--- DEBUG       Optimizer type: adamw
|--- INFO        Setup losses
|--- INFO        Setup training scheme
|--- INFO        Setting up training scheme: training_scheme_1 - [('warmup_dann', 20, False), ('full_model', 50, True)]
|--- INFO        ##-- Run model training
|--- DEBUG       Optimizer type: adamw
|--- INFO        ##-- WARMUP_DANN - Step 0, running warmup_dann strategy with permutation = False for 20 epochs
|--- INFO        Use permutation strategy? use_perm = False
|--- INFO        Epoch 1/70, Current strat Epoch 1/20
|--- DEBUG       Generate batches
|--- INFO        Epoch 2/70, Current strat Epoch 2/20
|--- DEBUG       Generate batches
|--- INFO        Epoch 3/70, Current strat Epoch 3/20
|--- DEBUG       Generate batches
        Use permutation strategy? use_perm = False
|--- INFO        Epoch 1/70, Current strat Epoch 1/20
|--- DEBUG       Generate batches
|--- INFO        Epoch 2/70, Current strat Epoch 2/20
|--- DEBUG       Generate batches
|--- INFO        Epoch 3/70, Current strat Epoch 3/20
|--- DEBUG       Generate batches
